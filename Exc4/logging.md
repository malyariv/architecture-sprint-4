## Задание 4. Логирование
- **Проанализируйте систему компании и C4-диаграмму в контексте планирования логирования.** Опишите, какие логи нужно собирать и отметьте на схеме, из каких систем требуется сбор логов. Составьте список необходимых логов с уровнем INFO.  
  Например, изменение статуса заказа. Логируем время, идентификатор покупателя, номер заказа.  
  Напишите, будете ли вы использовать другие уровни логирования и при каких обстоятельствах.

| Когда логировать | Уровень | Сервис | Что логировать |
|---|---|---|---|
|Все опреации с изменением статуса заказа |INFO|Shop API, MES API, CRM API| userId, orderId, status, service, operation, requestId, date, message |
|Ошибки|ERROR|Shop API, MES API, CRM API| userId, orderId, status, service, operation, requestId, date |
|Поход в базу|DEBUG|Shop API, MES API, CRM API| userId, orderId, status, service, operation, requestId, date |


- **Добавьте в файл раздел «Мотивация».** Напишите здесь, почему в систему нужно добавить логирование и что это даст компании. Опишите три-пять технические и бизнес-метрики решения, на которые может повлиять внедрение логирования.
  Команда не сможет реализовать единовременно логирование и трейсинг всех выделенных для этого систем. Поэтому опишите, для каких систем нужно настраивать логирование и трейсинг в первую очередь и почему.

  Если трейсинг в первую очередь позволяет проследить последовательность операций, оценить время выполнения каждой и найти в случае необходимости, где происходит ошибка, то логирование нацелено на выявление причин возникновения ошибок, в том числе и проблем с бизнес-логикой. Также логирование позволит рассчитать такие бизнес-метрики, как DAU, количество уникальных пользователей в день, их среднее количество заказов, конверсию и retention.

- **Добавьте раздел «Предлагаемое решение».**  
  Опишите, как и с помощью каких технологий будет реализовано логирование, какие компоненты нужно внедрить или доработать. Отразите компоненты и новые связи на схеме.
  Проработайте политику безопасности в отношении логов — как будет происходить работа с чувствительными данными, кто будет иметь доступ к логам.
  Проработайте политику хранения в отношении логов — будет ли это отдельный индекс под систему, сколько они будут храниться и какого размера будут.

  Предлагается использовать Logstach и Clickhouse для хранения логов. Clickhouse обладает вызокой производительностью на запись и хорошо подходит для хранения логов. Так как зачастую нужен поиск по простым полям (userId, orderId, status, service, operation, requestId, date), то не вижу смысла в использовании Elastic.
- **Проработайте необходимые мероприятия для превращения системы сбора логов в систему анализа логов:**
  Нужно ли настроить какой-то алертинг?
  Нужно ли искать аномалии? Например, было четыре записи о создании заказов и за секунду их стало 10 000. Возможно, происходит DDoS-атака конкурентами.

  Кажется, что при DDoS-атаке должны упасть сервисы, что будет сразу заметно на мониторнгах. Кроме того, можно использовать паттерн Circuit Breaker, чтобы давать возможность восстановится сервисам. 